!function(i){i.isScrollToFixed=function(o){return!!i(o).data("ScrollToFixed")},i.ScrollToFixed=function(o,e){function S(){r.trigger("preUnfixed.ScrollToFixed"),U(),r.trigger("unfixed.ScrollToFixed"),u=-1,p=r.offset().top,x=r.offset().left,t.options.offsets&&(x+=r.offset().left-r.position().left),-1==a&&(a=x),s=r.css("position"),n=!0,-1!=t.options.bottom&&(r.trigger("preFixed.ScrollToFixed"),w(),r.trigger("fixed.ScrollToFixed"))}function v(){var i=t.options.limit;return i?"function"==typeof i?i.apply(r):i:0}function m(){return"fixed"===s}function h(){return"absolute"===s}function b(){return!(m()||h())}function w(){if(!m()){var i=r[0].getBoundingClientRect();g.css({display:r.css("display"),width:i.width,height:i.height,"float":r.css("float")}),cssOptions={"z-index":t.options.zIndex,position:"fixed",top:"40px",bottom:-1==t.options.bottom?"":t.options.bottom,"margin-left":"0px"},t.options.dontSetWidth||(cssOptions.width=r.css("width")),r.css(cssOptions),r.addClass(t.options.baseClassName),t.options.className&&r.addClass(t.options.className),s="fixed"}}function C(){var i=v(),o=x;t.options.removeOffsets&&(o="",i-=p),cssOptions={position:"absolute",top:i,left:o,"margin-left":"0px",bottom:""},t.options.dontSetWidth||(cssOptions.width=r.css("width")),r.css(cssOptions),s="absolute"}function U(){b()||(u=-1,g.css("display","none"),r.css({"z-index":c,width:"",position:l,left:"",top:f,"margin-left":""}),r.removeClass("scroll-to-fixed-fixed"),t.options.className&&r.removeClass(t.options.className),s=null)}function y(i){i!=u&&(r.css("left",x-i),u=i)}function z(){var i=t.options.marginTop;return i?"function"==typeof i?i.apply(r):i:0}function A(){if(i.isScrollToFixed(r)&&!r.is(":hidden")){var o=n,e=b();n?b()&&(p=r.offset().top,x=r.offset().left):S();var s=i(window).scrollLeft(),d=i(window).scrollTop(),f=v();t.options.minWidth&&i(window).width()<t.options.minWidth?b()&&o||(N(),r.trigger("preUnfixed.ScrollToFixed"),U(),r.trigger("unfixed.ScrollToFixed")):t.options.maxWidth&&i(window).width()>t.options.maxWidth?b()&&o||(N(),r.trigger("preUnfixed.ScrollToFixed"),U(),r.trigger("unfixed.ScrollToFixed")):-1==t.options.bottom?f>0&&d>=f-z()?e||h()&&o||(N(),r.trigger("preAbsolute.ScrollToFixed"),C(),r.trigger("unfixed.ScrollToFixed")):d>=p-z()?(m()&&o||(N(),r.trigger("preFixed.ScrollToFixed"),w(),u=-1,r.trigger("fixed.ScrollToFixed")),y(s)):b()&&o||(N(),r.trigger("preUnfixed.ScrollToFixed"),U(),r.trigger("unfixed.ScrollToFixed")):f>0?d+i(window).height()-r.outerHeight(!0)>=f-(z()||-O())?m()&&(N(),r.trigger("preUnfixed.ScrollToFixed"),"absolute"===l?C():U(),r.trigger("unfixed.ScrollToFixed")):(m()||(N(),r.trigger("preFixed.ScrollToFixed"),w()),y(s),r.trigger("fixed.ScrollToFixed")):y(s)}}function O(){return t.options.bottom?t.options.bottom:0}function N(){var i=r.css("position");r.trigger("absolute"==i?"postAbsolute.ScrollToFixed":"fixed"==i?"postFixed.ScrollToFixed":"postUnfixed.ScrollToFixed")}var t=this;t.$el=i(o),t.el=o,t.$el.data("ScrollToFixed",t);var s,l,d,f,c,n=!1,r=t.$el,p=0,x=0,a=-1,u=-1,g=null,W=function(){r.is(":visible")?(n=!1,A()):U()},$=function(){window.requestAnimationFrame?requestAnimationFrame(A):A()},D=function(i){i=i||window.event,i.preventDefault&&i.preventDefault(),i.returnValue=!1};t.init=function(){t.options=i.extend({},i.ScrollToFixed.defaultOptions,e),c=r.css("z-index"),t.$el.css("z-index",t.options.zIndex),g=i("<div />"),s=r.css("position"),l=r.css("position"),d=r.css("float"),f=r.css("top"),b()&&t.$el.after(g),i(window).bind("resize.ScrollToFixed",W),i(window).bind("scroll.ScrollToFixed",$),"ontouchmove"in window&&i(window).bind("touchmove.ScrollToFixed",A),t.options.preFixed&&r.bind("preFixed.ScrollToFixed",t.options.preFixed),t.options.postFixed&&r.bind("postFixed.ScrollToFixed",t.options.postFixed),t.options.preUnfixed&&r.bind("preUnfixed.ScrollToFixed",t.options.preUnfixed),t.options.postUnfixed&&r.bind("postUnfixed.ScrollToFixed",t.options.postUnfixed),t.options.preAbsolute&&r.bind("preAbsolute.ScrollToFixed",t.options.preAbsolute),t.options.postAbsolute&&r.bind("postAbsolute.ScrollToFixed",t.options.postAbsolute),t.options.fixed&&r.bind("fixed.ScrollToFixed",t.options.fixed),t.options.unfixed&&r.bind("unfixed.ScrollToFixed",t.options.unfixed),t.options.spacerClass&&g.addClass(t.options.spacerClass),r.bind("resize.ScrollToFixed",function(){g.height(r.height())}),r.bind("scroll.ScrollToFixed",function(){r.trigger("preUnfixed.ScrollToFixed"),U(),r.trigger("unfixed.ScrollToFixed"),A()}),r.bind("detach.ScrollToFixed",function(o){D(o),r.trigger("preUnfixed.ScrollToFixed"),U(),r.trigger("unfixed.ScrollToFixed"),i(window).unbind("resize.ScrollToFixed",W),i(window).unbind("scroll.ScrollToFixed",$),r.unbind(".ScrollToFixed"),g.remove(),t.$el.removeData("ScrollToFixed")}),W()},t.init()},i.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3,baseClassName:"scroll-to-fixed-fixed"},i.fn.scrollToFixed=function(o){return this.each(function(){new i.ScrollToFixed(this,o)})}}(jQuery);